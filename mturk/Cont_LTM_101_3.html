<!-- Paul Scotti 2017
originally modified from Tim Brady url=http://timbrady.org/turk/ensembleindivdiff/e9/ -->

<!-- Preload javascript and css files -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<script src="./Cont_LTM_101_files/jquery.min.js"></script>
<script src="./Cont_LTM_101_files/seedrandom.js"></script>
<script src="./Cont_LTM_101_files/colors.js"></script>
<script src="./Cont_LTM_101_files/TimTurkTools.js"></script>
<script src="./Cont_LTM_101_files/beep.js"></script>
<script src="./Cont_LTM_101_files/jcanvas.min.js"></script>  
<script src="./Cont_LTM_101_files/chance.js"></script>  
    
<!-- load Firebase server javascript, we are just using it for storage -->
<script src="https://www.gstatic.com/firebasejs/4.8.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.8.2/firebase-storage.js"></script>

<link rel="stylesheet" type="text/css" href="./Cont_LTM_101_files/contReport.css">
<link rel="stylesheet" type="text/css" href="./Cont_LTM_101_files/showTrials.css">
<link rel="stylesheet" type="text/css" href="./Cont_LTM_101_files/experiment.css"> 

</head>
<body style="">

<!-- Instructions: -->
<div id="instructions">
  <p>In this HIT, you will have to perform 2 separate tasks. It should take about 30 minutes total to complete. The first task is an attentional task and the second is a memory task.</p>
  <p>In the first part, you will see colored objects presented one at a time. For example, one object may look like this:</p>
  <p align="center"><img src="https://paulscotti.github.io/mturk/Cont_LTM_101_files/Instruct1.png" width="400"></p>
  <p><strong>If an object is ever immediately repeated</strong> (e.g., the same phone is presented twice in a row), then click on the screen using your mouse. Be aware that you only have 2 seconds to respond before the next object is presented. You will hear a high-pitched beep for a correct response and a low-pitched beep for an incorrect response.</p>
    
  <p> After you have seen all of the objects, you will be tested on your memory for each object's color. A previously observed object will be presented on the screen, and you will be required to move your mouse around a black outside circle to adjust the color of the object. Once you feel you have matched the color of the object to its originally presented color, click to lock in your answer and move on to the next object.</p>
    
  <p align="center"><img src="https://paulscotti.github.io/mturk/Cont_LTM_101_files/Instruct2.png" width="400"></p>
    
  <p>It is important that you be as <em>precise and as accurate as possible</em> when reporting the original colors for the objects. Also note that since this is an experiment designed to study memory, we advise that you <strong>do not take any breaks after starting this study</strong>.
      
  <p><strong>To start off with, we'll give you a few practice trials</strong>. During practice, you will see colored objects presented one at a time. Remember to click on the screen as quickly as possible if an object is immediately repeated. After you have seen all the practice objects, you will then be asked to report the original colors of the objects.</p> 
    
  <p style="text-align: center"><a href="javascript:StartExperiment()" id="startExperimentButton" style="display: inline;">Start Experiment</a><span id="loading" style="display: none;">Images still loading. Please wait. &nbsp; &nbsp; <img src="./timbrady.org_files/spinner.gif" style="width: 30px; height: 30px"></span></p>
    
  <!-- Consent statement at bottom: -->
    <div id="consentDiv"><p><u>Consent to Participate in Research:</u></p><p>By answering the following questions, you are participating in a study being performed by cognitive scientists at The Ohio State University. The purpose of this research is to examine human attention and memory performance.</p><p>If you have questions or concerns about this research, or if you would like to receive a report of this research when it is completed, please contact Paul Scotti at scotti.5@osu.edu. </p><p>Your participation in this research is completely voluntary. If you choose to participate, you may change your mind and leave the study at any time. Refusal to participate or stopping your participation will involve no penalty or loss of benefits to which you are otherwise entitled.</p><p>Upon completion of this HIT, your Amazon Mechanical Turk Worker ID will be made available to the experimenters. Only select lab personnel will have access to the requester Mechanical Turk site, and Worker IDs will only be used to confirm study completion and assign compensation.</p><p>You may decline to answer any or all of the following questions. Your anonymity is assured; the researchers who have requested your participation will not receive any personal information about you. </p><p>For questions about your rights as a participant in this study or to discuss other study-related concerns or complaints with someone who is not part of the research team, you may contact Ms. Sandra Meadows in the Office of Responsible Research Practices at meadows.8@osu.edu.</p><p><b>By continuing, you are confirming that you have read the above information, voluntarily agree to participate, are over 18 years of age, and have normal or corrected-to-normal vision.</b></p></div>
</div>

<!-- Start form here to capture comments -->
<form id="turkSubmit" action="https://workersandbox.mturk.com/mturk/externalSubmit" method="get">
<input type="hidden" name="assignmentId" id="assignmentId" value="">
<input type="hidden" name="assignmentId" id="assignmentId" value="">
<input type="submit" value="Submit" name="submitButton" id="submitButton" style="display: none"></form>
<!-- submit to turk
https://workersandbox.mturk.com/mturk/externalSubmit
https://www.mturk.com/mturk/externalSubmit
-->

<!-- Screen for collecting comments when they are done: -->
<div id="done"><div id="doneText">Thanks very much for your participation!<br><br>Any comments for us? (Was it fun? Any technical difficulties?)<br><br>
<textarea name="comments" id="comments" style="width: 300px; height: 200px"></textarea><br><br>
<a href="javascript:SaveData()" id="timSubmit">Click to Submit HIT</a>
</div><div id="saving">Saving . . .</div></div>
    
<!-- Basic structure for a trial: --> 

<div id="showTrial">
<div id="fixation">+</div>
<div id="allItems">
<canvas id="item"  width=400 height=400></canvas></div></div>
    
<!-- Structure for continuous report after the trial: -->
<div id="continuousReport"> 
<canvas id="contItem"  width=400 height=400></canvas>
<div id="ring"></div><div id="pointer">&nbsp;</div></div>
    
<!-- feedback -->
<div id="feedback">
    <div id="feedbackReportedText">Your response:</div><canvas id="feedbackReportedTri" width=300 height=300></canvas><div id="feedbackCorrectText">Correct response:</div><canvas id="feedbackCorrectTri" width=300 height=300></canvas><div id="feedbackError">Your error was: 10 deg (aim for less than 10 degrees!).<br>Click to continue.</div></div>
    
<form id="survey2" style="display: none;">
    <center>
    <div id = "doneText"><p>We secretly manipulated how likely an object was to have a certain color.<br><br><p>Did you notice that most objects were of approximately the same color?</p></div>
    <br><br><br><br>
    <input name="choice" type="radio" value="yes" id="surveyresponse" /> Yes
    <br><br>
    <input name="choice" type="radio" value="nope" id="surveyresponse2" /> Not really 
    <br><br><br><br>
    <a href="javascript:completeForm();" id="startExperimentButton" style="display: inline;">Submit</a>
    </center>
</form>
    
<!-- Preload images, needs to be below divs -->
<script src="./Cont_LTM_101_files/loadimg.js"></script>  
    
<script>      
// Initialize Firebase
var config = {
    apiKey: "AIzaSyBeD1E8RCvOck3CeWzXbg2hGURf-sSrx8A",
    authDomain: "scotti-92222.firebaseapp.com",
    databaseURL: "https://scotti-92222.firebaseio.com",
    projectId: "scotti-92222",
    storageBucket: "scotti-92222.appspot.com",
    messagingSenderId: "123079954596"
};
firebase.initializeApp(config);
    
/* Options: */
var displayTime = 1000;
var isiTime = 1000;
var numTrialsPerPart = [2, 2]; /*204 trials*/

var practiceTriTrials = [];
var triTrials = [];
var repeatTriTrials = [];
var totalTrials = [];

/* Pointers for where we are in the experiment: */
var currentTrial = -1;
var currentPart = 0;

var currentFeedTrial = -1;
var feedbackPhase = 0;
var repeat = 0;
var numRepeats = 0; 
var hit = 0;
survey = 0;
    
/* Randomize orderings */
Shuffle(dx.r_study);
chance1 = Chance(123);
dx.r_study = dx.r_study.slice(0,numTrialsPerPart[1]);
dx.r_test = dx.r_study;
dx.r_test = chance1.shuffle(dx.r_test); 
chance1 = Chance(123);
dx.r_pracimg = chance1.shuffle(dx.pracimg); 
chance1 = Chance(123);

Shuffle(dx.r_repeatimg);
dx.r_repeatimg = dx.r_repeatimg.splice(dx.r_repeatimg.length-30);
    
/* Setup reused image variable */
var img = new Image();
img.crossOrigin = "anonymous";
    
/* Setting up canvas contexts */
var item = document.getElementById("item");
var ctx = item.getContext("2d");
contItem = document.getElementById("contItem");
var ctx2 = contItem.getContext("2d");
var feedbackReportedTri = document.getElementById("feedbackReportedTri");
var ctx3 = feedbackReportedTri.getContext("2d");
feedbackCorrectTri = document.getElementById("feedbackCorrectTri");
var ctx4 = feedbackCorrectTri.getContext("2d");
    
/* Generate trials: Do it the same for each subject by seeding the random number generator the same every time. */
function GenerateTrials() {
  Math.seedrandom('pablors');
    
  seed = Math.floor(Math.random()*360);
  seed = [seed, (seed + 90)];
  seed = [seed[0], seed[1], (seed[1] + 90)];
  seed = [seed[0], seed[1], seed[2], (seed[2] + 90)];
  wrap(seed);
    
  for (var i=0; i<numTrialsPerPart[1]; i++) { 
    var pickSeed = dx.TrialType[i];
    var curMean = seed[pickSeed] + (Math.floor(Math.random()*90) - 45);
    wrap(curMean);
      triTrials.push({'mean': curMean, 
                      'type': 'color', 
                      'isPractice': 0,
                      'items': curMean});
  }
  triTrials = Shuffle(triTrials);

  for (var i=0; i<numTrialsPerPart[0]; i++) { 
    var curMean = Math.floor(Math.random()*360);
    practiceTriTrials.push({'mean': curMean, 
                    'type': 'color', 
                    'isPractice': 1,
                    'items': curMean});
  }
    
  for (var i=0; i<dx.r_TrialType.length; i++) { 
    var pickSeed = dx.r_TrialType[i];
    var curMean = seed[pickSeed] + (Math.floor(Math.random()*90) - 45);
    wrap(curMean);
    repeatTriTrials.push({'mean': curMean, 
                    'type': 'color', 
                    'isPractice': 0,
                    'items': curMean});
  } 
    repeatTriTrials = Shuffle(repeatTriTrials);
}

/* Start the experiment. */
function StartExperiment() {
  if (IsOnTurk() && IsTurkPreview()) {
    alert("Please accept the HIT before continuing.");
    return false;
  }
  GenerateTrials();

  totalTrials = [practiceTriTrials, triTrials];
  r_totalTrials = [chance1.shuffle(practiceTriTrials), triTrials];
  chance1 = Chance(123); r_totalTrials = [r_totalTrials[0], chance1.shuffle(triTrials)];

  $('#instructions').hide();
    
  NextTrial();
}

/* Show the next trial or show the done screen if they are finished: */
function NextTrial() {
  currentTrial++;
  $('#fixation').css('color','black'); /* fixation back to black in case it wasn't */
    
  if (currentTrial>numTrialsPerPart[currentPart]-1) {
      alert("You will now see previously displayed objects again, one at a time. Please move your mouse along the black outside circle to adjust the color of the object until it matches its original color (be as precise as possible). Then click to continue.");
      /* Start continuous color report trials */
      NextFeedTrial();
      /* need return; otherwise the ShowTrial below executes */
      return;
  }
  ShowTrial(totalTrials[currentPart][currentTrial]);
}
    
function RepeatTrial() {
  var imgNum = repeatTriTrials[numRepeats].mean;
  repeat = repeat + 1;
    
  if (repeat == 1) {
      tempTrial = currentTrial;
      currentTrial = -999; }
  
  /* reset and then initialize audio code */
  $(document).off("click");
  var stopclick = 0;
  $(document).on("click", function (e) {
    if (stopclick == 0) {
        if (repeat == 2) {
            new Beep(22050).play(1300, .2, [Beep.utils.amplify(8000)]);
            console.log('yes');
            $('#fixation').css('color','rgb(0,255,0)');
            hit = 1;
        } else {
            new Beep(22050).play(400, .2, [Beep.utils.amplify(8000)]);
            console.log(repeat);
            $('#fixation').css('color','red');
        }
        stopclick = 1;
    }
  });
    
  if (repeat <= 2) {
      img.onload = function() {
          start(ctx,imgNum,200,200); 
      }
      if (currentPart == 0) {
          img.src = $('#' + dx.repeatpracimg[0])[0].src; 
      } else {
          img.src = $('#' + dx.repeatimg[numRepeats])[0].src;
          if (repeat == 2) {
          numRepeats = numRepeats + 1;
          }
      }

      $('#showTrial').show();
      setTimeout(function() {      
        $('#allItems').css('margin-top', 0);
        setTimeout(function() { 
            $('#allItems').css('margin-top', -1000);
            setTimeout(function() {
              $('#showTrial').hide();
                    RepeatTrial();
            }, isiTime);
        }, displayTime);
      }, 500);
  } else if (repeat == 3) {
    repeat = 0;
    currentTrial = tempTrial;
    if (hit == 0 & currentPart == 0) {
        alert('The phone repeated! Please click the screen when an object repeats.');
        NextTrial();
    } else {
        NextTrial();
    }
  }
} 
    
/* Show the next continuous color report trial: */
function NextFeedTrial() {
  /* Turn off listening for clicks, prevents beeping */
  $(document).off("click");
  currentFeedTrial++;
    
  if (currentFeedTrial>numTrialsPerPart[currentPart]-1) {
    if (currentPart == 1) {
      $('showTrial').hide;    
      Survey();
      return;
    } else {
      currentFeedTrial = -1;
      currentPart++;
        alert("Okay, time for the real experiment. You won't get feedback about how you are doing anymore. Please do your best!");
        currentTrial = -1;
        NextTrial();
        return;
    }
  }
  
  if (currentFeedTrial <= 0) {
      /* Initialize first object */
      if (currentPart == 0) {
        img.src = $('#' + dx.r_pracimg[0])[0].src; 
      } else {
        img.src = $('#' + dx.r_test[0])[0].src; 
  }}
    
  ShowContinuousReport(r_totalTrials[currentPart][currentFeedTrial]);
        
  /* Set starting color as grayscale */
  start(ctx2,'gray',200,200); 
  mouseMoved = 0;
}

/* Basic trial structure: Wait for click; then show the stimuli for this trial; then delay for fixed ISI; then call ShowContinuousReport */
function ShowTrial(trialStruct) {
    var stopclick = 0;
    
    $(document).on("click", function (e) {
        if (stopclick == 0) {
            new Beep(22050).play(400, .2, [Beep.utils.amplify(8000)]);
            console.log(repeat);
            $('#fixation').css('color','red');
            hit = 0;
            stopclick = 1;
        }
    });
    
    console.log(currentTrial);
    if (currentPart == 1) {
        console.log(dx.r_study[currentTrial]);
    }
    
    img.onload = function() {
      start(ctx,trialStruct.items,200,200); 
    }
    if (currentPart == 0) {
    img.src = $('#' + dx.pracimg[currentTrial])[0].src;
    } else {
    img.src = $('#' + dx.r_study[currentTrial])[0].src;
    }
    
    $('#allItems').css('margin-top', -1000);
    $('#showTrial').show();
    setTimeout(function() {
        $('#allItems').css('margin-top', 0);
        setTimeout(function() { 
            $('#allItems').css('margin-top', -1000);
            setTimeout(function() {
              $('#showTrial').hide();
                if (currentPart == 0) {
                    if (dx.repeatprac.includes(currentTrial)) { 
                        RepeatTrial(); 
                    } else {
                        NextTrial(); 
                    }
                } else {
                    if (dx.r_repeatimg.includes(100+currentTrial)) { 
                        RepeatTrial(); 
                    } else {
                        NextTrial(); 
                    }
                }
            }, isiTime);
        }, displayTime);
    }, 500);
}

/* Always track the mouse */
var mouseX, mouseY;
$(function() {
  $(document).bind('mousemove.overall', function(e) {
    mouseX = e.pageX;
    mouseY = e.pageY;
  });
});

function ShowContinuousReport(trialStruct) {
    
  var centerX = 300, centerY = 300;
  var ringSize = 250;
  var angleDeg = 0;
  var curError = 360;
  var startTime = new Date();    
    
    $(document).bind('mousemove.curTrial', function(e) {
        var parentOffset = $('#continuousReport').offset(); 
        var relX = e.pageX - parentOffset.left - centerX;
        var relY = e.pageY - parentOffset.top - centerY;
        var curAngle = Math.atan2(relY,relX);
        angleDeg = curAngle / Math.PI * 180.0;
        angleDeg = (angleDeg < 0) ? angleDeg+360:angleDeg;
        var imgNum = Math.round(angleDeg);
        mouseMoved = 1;
        start(ctx2,imgNum,200,200); 
        if (currentPart == 0) {
            img.src = $('#' + dx.r_pracimg[currentFeedTrial])[0].src;
        } else if (survey == 0) {
            img.src = $('#' + dx.r_test[currentFeedTrial])[0].src;
        } else if (survey == 1) {
            img.src = $('#999')[0].src;
        }
        $('#pointer').css({'left': centerX + Math.cos(curAngle)*ringSize-9, 
                           'top': centerY + Math.sin(curAngle)*ringSize-9});

        curError = Math.abs(angleDeg-trialStruct.mean);
        if (curError > 180) {
            curError = 360-curError;
        }
        
        if (trialStruct.isPractice) {
          $('#feedbackError').html("Your error was: " + Math.round(curError) + " deg (aim for less than 30 deg!)<br><br>Click to continue.");
        }
            
        if (e.isFakeTrigger) {
          trialStruct.startedAngle = Math.round(angleDeg);
        }
    });
  
    $(document).bind('click.curTrial', function(e) {
        /* Show approximate feedback: amazing! < 15, good! < 30 */
        if (curError <= 15) {
            feedText = 'Amazing!';
        } else if (curError <= 30) {
            feedText = 'Good!'; 
        } else {
            feedText = '...';
        }
        document.getElementById("fixation").innerHTML = feedText;
        
        if (survey == 1) {
            explicitErr = curError;
        }
        
        if (mouseMoved == 0) {
            alert('Move your mouse around the circle to select the original object color. Please be as precise as possible.');
        } else {
            trialStruct.reportedAngle = Math.round(angleDeg);
            trialStruct.rt = (new Date()) - startTime;
            $(document).unbind('click.curTrial');
            $(document).unbind('mousemove.curTrial');
            $("#continuousReport").hide();
            if (survey == 0) {
                if (trialStruct.isPractice) {
                    $('#feedbackError').html("Your error was: " + Math.round(curError) + " deg (aim for less than 30 deg.!)<br><br>Click to continue.");

                    var imgNum = Math.round(angleDeg);
                    start(ctx3,imgNum,80,100);
                    var imgNum = Math.round(trialStruct.mean);
                    start(ctx4,imgNum,40,100);

                    if (currentFeedTrial+1 < numTrialsPerPart[0]) {
                    img.src = $('#' + dx.r_pracimg[currentFeedTrial+1])[0].src;  
                    }

                    ctx2.drawImage(img, 200, 200); 
                    $('#feedback').show();
                    $(document).bind('click.feedback', function(e) {
                        $('#feedback').hide(); 

                        if (currentFeedTrial+1 < numTrialsPerPart[0]) {
                            img.src = $('#' + dx.r_pracimg[currentFeedTrial+1])[0].src;  
                        }

                        ctx2.drawImage(img, 200, 200); 
                        NextFeedTrial();
                        document.getElementById("fixation").innerHTML = '+';
                        $(document).unbind('click.feedback');
                    });
                } else if (currentFeedTrial>=numTrialsPerPart[currentPart]-1) { /* this is to prepare the gray square in explicit test */
                    $('#showTrial').show();
                    img.src = $('#999')[0].src;  
                    setTimeout(function() {
                        ctx2.drawImage(img, 200, 200); 
                        NextFeedTrial();
                        document.getElementById("fixation").innerHTML = '+';
                        $('#showTrial').hide();
                    }, isiTime);
                } else { 
                    $('#showTrial').show();
                    if (currentFeedTrial < numTrialsPerPart[0]) {
                        img.src = $('#' + dx.r_test[currentFeedTrial+1])[0].src;  
                    }
                    setTimeout(function() {
                        ctx2.drawImage(img, 200, 200); 
                        NextFeedTrial();
                        document.getElementById("fixation").innerHTML = '+';
                        $('#showTrial').hide();
                    }, isiTime);
                }
            } else {
                $('#showTrial').hide();
                Survey2(); 
            }
        }
    });
    
  $("#continuousReport").show();    
  e = $.Event('mousemove');
  e.pageX = mouseX;
  e.pageY = mouseY;
  e.isFakeTrigger = true;
  $(document).trigger(e);
}

function Survey() { 
  $("#showTrial").hide(); 
  survey = 1;
  alert('Before you go, please select the most frequent color you think objects appeared as throughout the experiment.')
  ShowContinuousReport({mean: seed[0], type: "color", isPractice: 0, items: 999});
  start(ctx2,'gray',200,200); 
  mouseMoved = 0;
} 
    
function Survey2() {
    $("#survey2").show(); 
} 
    
/* Done with the experiment; wait for comments and for them to hit Save */
function Done() {
  $('#done').show();
}
    
/* Choose what to save and then put it on the server */
function SaveData() {
  $('#done').children().hide();
  $('#saving').show();
  $('#assignmentId').val(GetAssignmentId());
  var newDate = new Date();
  var curID = (IsOnTurk())? GetAssignmentId() : prompt("Doesn't look like you " + 
  "are on Turk, so you're probably testing. Enter an ID to save your data with:", "id");
  d = { 
    "curID": curID,
    "curTime": newDate.today() + " @ " + newDate.timeNow(),
    "userAgent": navigator.userAgent,
    "windowWidth": $(window).width(),
    "windowHeight": $(window).height(),
    "screenWidth": screen.width,
    "screenHeight": screen.height,    
    "comments": $('#comments').val(),
    "totalTrials": totalTrials,
    "explicitError": explicitErr,
    "implicitResponse": implicitResp,
    "seeds": seed,
    "StudyOrder": dx.r_study,
    "TestOrder": dx.r_test,
    "SeedOrder": dx.TrialType
  };
    
    /* save to Firebase server */
    var blob = new Blob([JSON.stringify(d)], {type: "application/json"});
    var storageRef = firebase.storage().ref('data/' + curID + '.json');
    storageRef.put(blob);
    
    document.getElementById("saving").innerHTML = "Done!";
    
    alert($('#assignmentId'));
    document.forms[0].submit();
}

function start(context,deg,initX,initY) {
    if (deg == 'gray') {
        var col = [0,0,0];
    } else {
        deg=(deg>=360)?deg-360:deg;
        deg=(deg<0)?deg+360:deg;
        var col=colors.colors[deg];
    }
    
    context.drawImage(img, initX, initY);
    recolor(context,Math.round(col[0]),Math.round(col[1]),Math.round(col[2]),initX,initY);
}
function recolor(context,newR,newG,newB,initX,initY) {
     var imgData = context.getImageData(initX, initY, item.width, item.height);
     var data = imgData.data;
    for (var i = 0; i < data.length; i += 4) {
        red = data[i + 0];
        green = data[i + 1];
        blue = data[i + 2];
        var hsv = RGBtoHSV(red, green, blue);
        var hue = hsv.h * 360;
        /* If grayscale, else if not grayscale */
        if (newR == 0 & newG == 0 & newB == 0) {
            var newRgb = HSVtoRGB(hsv.h, 0, hsv.v);
        } else { 
            var temp = RGBtoHSV(newR,newG,newB);
            var newRgb = HSVtoRGB(temp.h, hsv.s, hsv.v);
        }
        data[i + 0] = newRgb.r;
        data[i + 1] = newRgb.g;
        data[i + 2] = newRgb.b;
    }
    context.putImageData(imgData, initX, initY);
}
function HSVtoRGB(h, s, v) {
    var r, g, b, i, f, p, q, t;
    if (arguments.length === 1) {
        s = h.s, v = h.v, h = h.h;
    }
    i = Math.floor(h * 6);
    f = h * 6 - i;
    p = v * (1 - s);
    q = v * (1 - f * s);
    t = v * (1 - (1 - f) * s);
    switch (i % 6) {
        case 0: r = v, g = t, b = p; break;
        case 1: r = q, g = v, b = p; break;
        case 2: r = p, g = v, b = t; break;
        case 3: r = p, g = q, b = v; break;
        case 4: r = t, g = p, b = v; break;
        case 5: r = v, g = p, b = q; break;
    }
    return {
        r: Math.round(r * 255),
        g: Math.round(g * 255),
        b: Math.round(b * 255)
    };
}
function RGBtoHSV(r, g, b) {
    if (arguments.length === 1) {
        g = r.g, b = r.b, r = r.r;
    }
    var max = Math.max(r, g, b), min = Math.min(r, g, b),
        d = max - min,
        h,
        s = (max === 0 ? 0 : d / max),
        v = max / 255;

    switch (max) {
        case min: h = 0; break;
        case r: h = (g - b) + d * (g < b ? 6: 0); h /= 6 * d; break;
        case g: h = (b - r) + d * 2; h /= 6 * d; break;
        case b: h = (r - g) + d * 4; h /= 6 * d; break;
    }

    return {
        h: h,
        s: s,
        v: v
    };
}  
    
/* Make sure all numbers in an array are between 0 and 360: */
function wrap(v) {
  for (var i=0; i<v.length; i++) {
    if (v[i]>360) { v[i]-=360; }
    if (v[i]<0) { v[i]+=360; }
  }
  return v;
} 

function completeForm() {
    if (document.getElementById("surveyresponse").checked) {
        implicitResp = 1;
    } else if (document.getElementById("surveyresponse2").checked) {
        implicitResp = 2;
    }
    //proceed only if they picked one of two options
    if (implicitResp > 0) {
        $('#survey2').hide();
        $('#instructions').hide();
        Done();
    } else {
        alert('Please select an option.');
    }  
    return false;  
}
    
$(window).load(function () {
  $('#startExperimentButton').show();
  $('#loading').hide();
});

$(function() {
  if (navigator.userAgent.indexOf('MSIE') != -1) {
    $('body').html('Unfortunately this HIT does not work in IE. It works in Chrome, Firefox or Safari. Sorry!');
  }
});    
    
</script>
</body></html>